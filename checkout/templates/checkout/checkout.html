{% extends 'base.html' %}
{% load static %}

{% block extra_title %}
Checkout
{% endblock %}

{% block content %}
<div class="container">
    <div class="row">
        <div class="col">
            <h1 class="display-2 text-center">Checkout</h1>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <h1 class="text-center display-5 mb-3">Summary</h1>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Title</th>
                        <th scope="col">Size</th>
                        <th scope="col">Quantity</th>
                        <th scope="col">Item Price</th>
                        <th scope="col">Item Total</th>
                    </tr>
                </thead>
                {% for item in items %}
                <tr>
                    <th scope="row">
                        {{ forloop.counter }}
                    </th>
                    <td>
                        {{ item.product.title|title }}
                    </td>
                    <td>
                        {% if item.size %}
                        {{ item.size }}
                        {% else %}
                        N/a
                        {% endif %}
                    </td>
                    <td>
                        {{ item.quantity }}
                    </td>
                    <td>
                        £{{ item.price }}
                    </td>
                    <td>
                        £{{ item.product_total }}
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col text-center">
            <a class="btn btn-info" href="">Edit bag</a>
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <p class="text-center">Subtotal: £{{ total }}</p>
        </div>
    </div>

    <div class="row">
        <div class="col">

        {% if total > 75 %}
                <p class="text-center">Delivery fee: £0.00</p>
            {% else %}
                <form action="{% url 'checkout' %}" method="POST">
                    {% csrf_token %}
                    <p>Please Select a Delivery Option</p>
                    <div>
                        <input class="form-check-input" type="radio" id="delivery" name="standard_delivery" value="{{ standard_delivery }}" checked>
                        <label class="form-check-label" for="delivery">
                          Standard Delivery (3 - 5 Working Days): £{{ standard_delivery }}
                        </label>
                    </div>
                    <div>
                        <input class="form-check-input" type="radio" id="delivery" name="next_day_delivery" value="{{ next_day_delivery }}">
                        <label class="form-check-label" for="delivery">
                          Standard Delivery (3 - 5 Working Days): £{{ next_day_delivery }}
                        </label>
                      </div>
                      <button class="btn btn-primary" type="submit">Set Delivery Option</button>
                </form>
            {% endif %}
        </div>
        
    </div>

    <div class="row mt-4">
        <div class="col text-center">
            <h3>Delivery Details</h3>
        </div>
    </div>

    {% if delivery_details %}
    <div class="row mt-4">
        <div class="col">
            <p>Delivery Details Confirmed!</p>
        </div>
    </div>
    <div class="row">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th scope="col">Address Line 1</th>
                    <th scope="col">Address Line 2</th>
                    <th scope="col">Post Code</th>
                    <th scope="col">Email Address</th>
                    <th scope="col">Town / City</th>
                </tr>
            </thead>
                <tr>
                    {% for x in delivery_details %}
                        <td>
                            {{ x }}
                        </td>
                    {% endfor %}
                </tr>
        </table>
    </div>
    <div class="row">
        <div class="col text-center">
            <a class="btn btn-info" href="">Edit Delivery Details</a>
        </div>
    </div>
    {% else %}
    <div class="row">
        <div class="col">
            <form method="POST" action="{% url 'checkout' }">
                {% csrf_token %}
                <div class="mb-3">
                    <label class="form-label" for="address_1">Address Line 1:</label>
                    <input required aria-required="true" class="form-control" name="address_1" type="text">
                </div>
                <div class="mb-3">
                    <label class="form-label" for="address_2">Address Line 2 (optional):</label>
                    <input class="form-control" name="address_2" type="text">
                </div>
                <div class="mb-3">
                    <label class="form-label" for="email">Email Address:</label>
                    <input class="form-control" required aria-required="true" type="email" name="email"
                        value="{{ user.email }}">
                </div>
                <div class="mb-3">
                    <label class="form-label" for="number">Mobile Number: <small>Optional</small></label>
                    <input class="form-control" type="number" name="number">
                </div>
                <div class="mb-3">
                    <label class="form-label" for="post_code">Post Code: <small>Must be in correct format (e.g. SW1A
                            2AA)</small></label>
                    <input onkeyup="this.value = this.value.toUpperCase();"
                        pattern="^(([A-Z][0-9]{1,2})|(([A-Z][A-Z-Y][0-9]{1,2})|(([A-Z][0-9][A-Z])|([A-Z][A-HJ-Y][0-9]?[A-Z])))) [0-9][A-Z]{2}$"
                        class="form-control" required aria-required="true" type="text" name="post_code">
                </div>
                <div class="mb-3">
                    <input type="submit" value="Submit">
                </div>
            </form>
        </div>
    </div>
    {% endif %}
    <div class="row mt-4">
        <div class="col">
            <div class="button-group">
                {% if user.is_authenticated %}
                <a class="btn btn-primary" href="">Proceed with checkout</a>
                {% else %}
                <a class="btn btn-primary" href="">Checkout as guest</a>
                <a class="btn btn-primary" href="{% url 'account_login' %}">Login</a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endblock %}