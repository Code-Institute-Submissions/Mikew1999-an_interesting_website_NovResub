{% extends 'base.html' %}
{% load static %}

{% block extra_title %}
Products
{% endblock %}

{% block content %}

<h1 class="display-4 pl-2 mt-2 mb-2 text-center">All Products</h1>

{% if selected %}
<p class="lead text-center">
    {{ products.count }} products found from your search
    "{{ selected }}"
    <br>
    {% if sort != 'title' %}
    Sorting by {{ sort }} <a href="{% url 'products' %}">Remove Sorting</a>
    {% endif %}
</p>
{% endif %}


<div class="text-center">
    <a class="btn btn-sm btn-outline-primary" onclick="showHideCategories()">Categories</a>
    <a class="btn btn-sm btn-outline-primary" onclick="showHideSort()">Sort</a>
</div>

<div class="categories-container text-center mt-4">
    <form method="GET">
        {% for category in categories %}
        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="{{ category.name }}" name="category"
                {% if category.name in selected %}checked{% endif %}>
            <label class="form-check-label" for="category">
                {{ category.friendly_name }}
            </label>
        </div>
        {% endfor %}
        <input type="submit" value="Search">
    </form>
</div>

<div class="sort-container text-center mt-4">
    <form method="GET">
        <label for="sort">Sorting</label>
        <select class="form-select" name="sort" aria-label="Sort">
            <option selected value="{{ sort }}">Product {{ sort }} ascending</option>
            <option value="-title">Product title ascending</option>
            <option value="category__name">Category descending</option>
            <option value="-category__name">Category Ascending</option>
            <option value="price">Price descending</option>
            <option value="-price">Price</option>
        </select>

        <ul class="list-inline-group">
            <li class="list-inline-item">
                <a class="btn btn-sm" href="{% url 'products' %}">Clear Sorting</a>
            </li>
            <li class="list-inline-item">
                <input class="btn btn-sm" type="submit" value="Search">
            </li>
        </ul>

    </form>
</div>

<div class="container">
    <div class="row">
        {% for item in products %}
        <div class="col-12 col-lg-6">
            <div class="card">
                <img class="product-image" src="{{ item.image }}" alt="Product Image">

                <div class="card-body">
                    <div class="card-header">{{ item.title }}</div>

                    <p class="description">{{ item.description }}</p>

                    <a href="{% url 'productdetails' product_id=item.pk %}">Read More</a>

                    <p class="rating">
                        Rating: {{ item.rate }}
                        <br>
                        Number of reviews: {{ item.count }}
                    </p>

                    <form class="form" action="" method="POST">
                        {% csrf_token %}
                        {% if user %}
                        {% if item.pk in user.liked %}
                        <a class="liked">
                            <i class="fas fa-thumbs-up"></i>
                        </a>
                        {% else %}
                        <a class="unliked">
                            <i class="far fa-thumbs-up"></i>
                        </a>
                        {% endif %}
                        {% else %}
                        <a class="unliked">
                            <i class="far fa-thumbs-up"></i>
                        </a>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block postloadjs %}
<script type="text/javascript">
    $('.categories-container').css('display', 'none');
    $('.sort-container').css('display', 'none');

    function showHideCategories() {
        $('.categories-container').toggle();
    }

    function showHideSort() {
        $('.sort-container').toggle();
    }

    function moreless() {
        $('.description').each(function() {
            // Finds item description
            var itemDescription = ($(this).html());
            // Finds length of description
            var itemLength = itemDescription.length;
            // Pulls the first 100 characters of description
            var sub = itemDescription.substring(0, 101);
            // sets description to first 100 characters
            $(this).html(sub);
        })
    }

    moreless();
</script>
{% endblock %}